<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>QR MenÃ¼ Admin Paneli</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <!-- Font Awesome (CDNJS) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <!-- SortableJS -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <!-- Firebase SDK (v8) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  
  <!-- Stil TanÄ±mlarÄ± (Admin Paneli CSS) -->
  <style>
    :root {
      --primary-color: #007bff;
      --secondary-color: #ffba00;
      --light-gray: #f4f6f9;
      --border-color: #ced4da;
    }
    /* Genel Ayarlar */
    body {
      font-family: 'Montserrat', sans-serif;
      background-color: var(--light-gray);
      margin: 0;
      padding: 0;
      color: #343a40;
    }
    /* GiriÅŸ EkranÄ± */
    .login-container {
      max-width: 400px;
      margin: 100px auto;
      background-color: #fff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      text-align: center;
    }
    .login-container h2 {
      margin-bottom: 20px;
    }
    .login-container input {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .login-container input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 5px rgba(0,123,255,0.5);
    }
    .login-container button {
      width: 100%;
      padding: 12px;
      background-color: var(--secondary-color);
      border: none;
      border-radius: 4px;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .login-container button:hover {
      background-color: #e0a800;
    }
    /* Admin Paneli Genel */
    #adminContent {
      display: none;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    header.header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #fff;
      padding: 15px 20px;
      border-bottom: 1px solid #dee2e6;
      margin-bottom: 20px;
    }
    header.header h1 {
      color: var(--primary-color);
      margin: 0;
      font-size: 24px;
    }
    .logout-button {
      background-color: #dc3545;
      color: #fff;
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .logout-button:hover {
      background-color: #c82333;
    }
    /* Sekme Navigasyonu */
    .tab-nav {
      display: flex;
      flex-wrap: wrap;
      background-color: #fff;
      border-bottom: 1px solid #dee2e6;
      margin-bottom: 20px;
    }
    .tab-nav button {
      flex: 1;
      padding: 15px;
      border: none;
      background-color: var(--light-gray);
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }
    .tab-nav button.active {
      background-color: #fff;
      border-bottom: 3px solid var(--primary-color);
      font-weight: bold;
    }
    /* Tab Ä°Ã§erikleri */
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    /* Firma Bilgileri Sekmesi */
    .company-info-form label {
      display: block;
      margin-bottom: 5px;
      color: #495057;
    }
    .company-info-form input {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
    }
    .company-info-form button {
      background-color: var(--primary-color);
      color: #fff;
      padding: 12px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .company-info-form button:hover {
      background-color: #0069d9;
    }
    /* Ana BÃ¶lÃ¼mler */
    main section {
      background-color: #fff;
      padding: 20px;
      margin-bottom: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    main section h2 {
      color: var(--primary-color);
      border-bottom: 2px solid #dee2e6;
      padding-bottom: 10px;
    }
    main section form {
      margin-top: 20px;
    }
    main section form label {
      display: block;
      margin-bottom: 5px;
      color: #495057;
    }
    main section form input,
    main section form select,
    main section form textarea {
      width: 100%;
      padding: 10px;
      margin: 6px 0 15px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    main section form input:focus,
    main section form select:focus,
    main section form textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 5px rgba(0,123,255,0.5);
    }
    main section form button {
      background-color: var(--primary-color);
      color: #fff;
      padding: 12px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    main section form button:hover {
      background-color: #0069d9;
    }
    /* Kategori Listeleme */
    #sortableCategories {
      list-style-type: none;
      padding: 0;
      margin: 0 0 20px 0;
    }
    .category-item {
      padding: 10px;
      margin: 5px 0;
      background-color: #f0f0f0;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      cursor: move;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .category-item button {
      margin-left: 10px;
      padding: 5px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .category-item button:first-of-type {
      background-color: #28a745;
      color: #fff;
    }
    .category-item button:last-of-type {
      background-color: #dc3545;
      color: #fff;
    }
    .category-item button:first-of-type:hover {
      background-color: #218838;
    }
    .category-item button:last-of-type:hover {
      background-color: #c82333;
    }
    /* ÃœrÃ¼n Listeleme */
    #productsList {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .product-item {
      display: flex;
      align-items: center;
      background-color: #fff;
      padding: 15px;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .product-item img {
      width: 80px;
      height: auto;
      margin-right: 15px;
      border-radius: 5px;
      object-fit: cover;
    }
    .product-item span {
      flex: 1;
      font-size: 18px;
      color: #343a40;
    }
    .product-item button {
      background-color: #28a745;
      color: #fff;
      padding: 8px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
      transition: background-color 0.3s;
    }
    .product-item button:hover {
      background-color: #218838;
    }
    .product-item .delete-button {
      background-color: #dc3545;
    }
    .product-item .delete-button:hover {
      background-color: #c82333;
    }
    /* Modal Genel Stil */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow-y: auto;
      background-color: rgba(0,0,0,0.5);
    }
    /* GeliÅŸmiÅŸ Modal TasarÄ±mÄ± */
    .modal-content {
      background-color: #fff;
      margin: 5% auto;
      border-radius: 8px;
      max-width: 600px;
      position: relative;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      animation: fadeIn 0.3s;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .modal-header {
      background-color: var(--primary-color);
      color: #fff;
      padding: 15px;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
      font-size: 20px;
      position: relative;
    }
    .modal-header .close {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 28px;
      cursor: pointer;
      color: #fff;
    }
    .modal-body {
      padding: 20px;
    }
    /* Ä°lerleme Ã‡ubuÄŸu */
    .progress-bar {
      width: 100%;
      background-color: #e9ecef;
      margin-top: 10px;
      border-radius: 4px;
      overflow: hidden;
    }
    .progress-bar-fill {
      height: 20px;
      background-color: var(--primary-color);
      width: 0%;
      text-align: center;
      color: white;
      line-height: 20px;
    }
    /* Dinamik Birim AlanlarÄ± */
    .variant-row {
      margin-bottom: 10px;
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .variant-row input {
      flex: 1;
    }
    .variant-row button {
      background-color: #dc3545;
      color: #fff;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 4px;
      transition: background-color 0.3s;
    }
    .variant-row button:hover {
      background-color: #c82333;
    }
    /* Ã‡oklu SeÃ§im kutusu kaldÄ±rÄ±ldÄ± -> ArtÄ±k yan Ã¼rÃ¼nler iÃ§in checkbox kullanÄ±lacak */
    /* Mobil DuyarlÄ±lÄ±k */
    @media (max-width: 768px) {
      .tab-nav button {
        font-size: 14px;
        padding: 10px;
      }
      .product-item, .category-item {
        flex-direction: column;
        align-items: flex-start;
      }
      .product-item button, .category-item button {
        width: 100%;
        margin-bottom: 10px;
      }
    }
  </style>
</head>
<body>
  <!-- GiriÅŸ EkranÄ± -->
  <div id="loginDiv" class="login-container">
    <h2>Admin GiriÅŸi</h2>
    <input type="email" id="email" placeholder="E-posta" required>
    <input type="password" id="password" placeholder="Åžifre" required>
    <button onclick="login()">GiriÅŸ Yap</button>
  </div>

  <!-- Admin Paneli Ä°Ã§eriÄŸi -->
  <div id="adminContent">
    <header class="header">
      <h1>QREVA 3 Admin Paneli</h1>
      <h2>HoÅŸ geldiniz-SÄ°NAN USTA</h2>
      <button onclick="logout()" class="logout-button">MASALAR Ä°Ã‡Ä°N QR KOD OLUÅžTUR</button>
    </header>
    
    <!-- Sekme Navigasyonu (5 Sekme: Kategoriler, Kategori Ekle, ÃœrÃ¼nler, ÃœrÃ¼n Ekle, Firma Bilgileri) -->
    <div class="tab-nav">
      <button id="btnCategories" class="active" onclick="switchTab('categories')">Kategoriler</button>
      <button id="btnAddCategory" onclick="switchTab('addCategory')">Kategori Ekle</button>
      <button id="btnProducts" onclick="switchTab('products')">ÃœrÃ¼nler</button>
      <button id="btnAddProduct" onclick="switchTab('addProduct')">ÃœrÃ¼n Ekle</button>
      <button id="btnCompanyInfo" onclick="switchTab('companyInfo')">Firma Bilgileri</button>
    </div>
    
    <!-- Sekme Ä°Ã§erikleri -->
    <div id="tabCategories" class="tab-content active">
      <main>
        <section id="categorySection">
          <h2>Kategoriler</h2>
          <ul id="sortableCategories"></ul>
        </section>
      </main>
    </div>
    
    <div id="tabAddCategory" class="tab-content">
      <main>
        <section id="addCategorySection">
          <h2>Yeni Kategori Ekle</h2>
          <form id="newCategoryForm">
            <label for="categoryName_tr">Kategori Ä°smi (TR)</label>
            <input type="text" id="categoryName_tr" placeholder="Kategori AdÄ± (TR)" required>
            <label for="categoryName_en">Kategori Ä°smi (EN)</label>
            <!-- Ä°ngilizce seÃ§eneÄŸi kaldÄ±rÄ±ldÄ±; alanÄ± yine koruyoruz ama sadece TÃ¼rkÃ§e girilecek -->
            <input type="text" id="categoryName_en" value="" readonly>
            <label for="categoryImage">Kategori Resmi</label>
            <input type="file" id="categoryImage" accept="image/*" required>
            <img id="categoryImagePreview" src="#" alt="Kategori Resmi" style="display:none; max-width:200px; margin-top:10px;">
            <div class="progress-bar" id="categoryProgressBar" style="display:none;">
              <div class="progress-bar-fill" id="categoryProgressBarFill">0%</div>
            </div>
            <button type="submit">Kategori Ekle</button>
          </form>
        </section>
      </main>
    </div>
    
    <div id="tabProducts" class="tab-content">
      <main>
        <section id="productSection">
          <h2>ÃœrÃ¼nler</h2>
          <div id="productFilter">
            <label for="filterCategory">Kategori SeÃ§in:</label>
            <select id="filterCategory">
              <option value="">Hepsi</option>
            </select>
          </div>
          <div id="productsList"></div>
        </section>
      </main>
    </div>
    
    <div id="tabAddProduct" class="tab-content">
      <main>
        <section id="addProductSection">
          <h2>Yeni ÃœrÃ¼n Ekle</h2>
          <form id="newProductForm">
            <label for="productName_tr">ÃœrÃ¼n Ä°smi (TR)</label>
            <input type="text" id="productName_tr" placeholder="ÃœrÃ¼n Ä°smi (TR)" required>
            <label for="productName_en">ÃœrÃ¼n Ä°smi (EN)</label>
            <!-- Ä°ngilizce alanÄ±, sadece TÃ¼rkÃ§e kullanÄ±lacaÄŸÄ± iÃ§in readonly -->
            <input type="text" id="productName_en" value="" readonly>
            
            <label for="productDesc_tr">ÃœrÃ¼n AÃ§Ä±klamasÄ± (TR)</label>
            <textarea id="productDesc_tr" placeholder="ÃœrÃ¼n AÃ§Ä±klamasÄ± (TR)" required></textarea>
            <label for="productDesc_en">ÃœrÃ¼n AÃ§Ä±klamasÄ± (EN)</label>
            <textarea id="productDesc_en" placeholder="ÃœrÃ¼n AÃ§Ä±klamasÄ± (EN)" readonly></textarea>
            
            <label for="productPrice">VarsayÄ±lan Fiyat (Zorunlu)</label>
            <input type="number" id="productPrice" placeholder="Tek fiyatlÄ± Ã¼rÃ¼n iÃ§in" required>
            
            <label for="productCategory">Kategori</label>
            <select id="productCategory" required>
              <option value="">Kategori SeÃ§in</option>
            </select>
            
            <label for="productStatus">ÃœrÃ¼n Durumu</label>
            <select id="productStatus" required>
              <option value="active" selected>Aktif</option>
              <option value="inactive">AskÄ±da</option>
            </select>

            <!-- Ek Alanlar -->
            <label for="productCookingTime">Ortalama HazÄ±rlanma SÃ¼resi (dk)</label>
            <input type="number" id="productCookingTime" placeholder="Ã–rn: 10" min="0">
            <label for="productCalorie">Kalori</label>
            <input type="number" id="productCalorie" placeholder="Ã–rn: 300" min="0">
            <label for="productAllergen">Alerjen Bilgisi</label>
            <input type="text" id="productAllergen" placeholder="Ã–rn: Gluten iÃ§erir">
            
            <!-- YanÄ±nda Ä°yi Gidenler: Checkbox Listesi -->
            <label>YanÄ±nda Ä°yi Gidenler</label>
            <div id="productSideDishesContainer"></div>
            
            <hr/>
            <h3>Birimler (Ä°steÄŸe BaÄŸlÄ±)</h3>
            <p style="font-size: 0.9em; color: #555;">
              Ã–rnek: "1 Porsiyon / 50 TL", "1.5 Porsiyon / 75 TL" vb.
            </p>
            <div id="newVariantsContainer"></div>
            <button type="button" style="margin-bottom:15px;" onclick="addVariantRow('newVariantsContainer')">Birim Ekle</button>
            
            <label for="fileElem">ÃœrÃ¼n Resmi</label>
            <input type="file" id="fileElem" accept="image/*" required>
            <img id="productImagePreview" src="#" alt="ÃœrÃ¼n Resmi" style="display:none; max-width:200px; margin-top:10px;">
            <div class="progress-bar" id="productProgressBar" style="display:none;">
              <div class="progress-bar-fill" id="productProgressBarFill">0%</div>
            </div>
            <button type="submit">ÃœrÃ¼n Ekle</button>
          </form>
        </section>
      </main>
    </div>
    
    <div id="tabCompanyInfo" class="tab-content">
      <main>
        <section id="companyInfoSection">
          <h2>Firma Bilgileri</h2>
          <form id="companyInfoForm" class="company-info-form">
            <label for="companyGoogleMaps">Google Haritalar Linki</label>
            <input type="text" id="companyGoogleMaps" placeholder="Google Haritalar URL">
            
            <label for="companyInstagram">Instagram Linki</label>
            <input type="text" id="companyInstagram" placeholder="Instagram URL">
            
            <label for="companyFacebook">Facebook Linki</label>
            <input type="text" id="companyFacebook" placeholder="Facebook URL">
            
            <label for="companyYoutube">YouTube Linki</label>
            <input type="text" id="companyYoutube" placeholder="YouTube URL">
            
            <!-- Yeni eklenen WhatsApp alanÄ± -->
            <label for="companyWhatsapp">WhatsApp SipariÅŸ HattÄ± (Telefon No - +90)</label>
            <input type="text" id="companyWhatsapp" placeholder="WhatsApp SipariÅŸ HattÄ±">
            
            <label for="companyWifi">WiFi Åžifresi</label>
            <input type="text" id="companyWifi" placeholder="WiFi Åžifresi">
            <button type="submit">Bilgileri Kaydet</button>
          </form>
        </section>
      </main>
    </div>
    
  </div>

  <!-- ÃœrÃ¼n GÃ¼ncelleme ModalÄ± -->
  <div id="updateProductModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        ÃœrÃ¼nÃ¼ GÃ¼ncelle
        <span class="close" id="closeModal">&times;</span>
      </div>
      <div class="modal-body">
        <form id="updateProductForm">
          <input type="hidden" id="updateProductId">
          
          <label for="updateProductName_tr">ÃœrÃ¼n Ä°smi (TR)</label>
          <input type="text" id="updateProductName_tr" placeholder="ÃœrÃ¼n Ä°smi (TR)" required>
          <label for="updateProductName_en">ÃœrÃ¼n Ä°smi (EN)</label>
          <input type="text" id="updateProductName_en" value="" readonly>
          
          <label for="updateProductDesc_tr">ÃœrÃ¼n AÃ§Ä±klamasÄ± (TR)</label>
          <textarea id="updateProductDesc_tr" placeholder="ÃœrÃ¼n AÃ§Ä±klamasÄ± (TR)" required></textarea>
          <label for="updateProductDesc_en">ÃœrÃ¼n AÃ§Ä±klamasÄ± (EN)</label>
          <textarea id="updateProductDesc_en" placeholder="ÃœrÃ¼n AÃ§Ä±klamasÄ± (EN)" readonly></textarea>
          
          <label for="updateProductPrice">VarsayÄ±lan Fiyat</label>
          <input type="number" id="updateProductPrice" placeholder="Tek fiyat" required>
          <label for="updateProductCategory">Kategori</label>
          <select id="updateProductCategory" required>
            <option value="">Kategori SeÃ§in</option>
          </select>
          
          <!-- Ek Alanlar -->
          <label for="updateProductCookingTime">Ortalama HazÄ±rlanma SÃ¼resi (dk)</label>
          <input type="number" id="updateProductCookingTime" placeholder="Ã–rn: 10" min="0">
          <label for="updateProductCalorie">Kalori</label>
          <input type="number" id="updateProductCalorie" placeholder="Ã–rn: 300" min="0">
          <label for="updateProductAllergen">Alerjen Bilgisi</label>
          <input type="text" id="updateProductAllergen" placeholder="Ã–rn: Gluten iÃ§erir">
          <label for="updateProductStatus">ÃœrÃ¼n Durumu</label>
          <select id="updateProductStatus" required>
            <option value="active">Aktif</option>
            <option value="inactive">AskÄ±da</option>
          </select>
          
          <!-- YanÄ±nda Ä°yi Gidenler: Checkbox Listesi -->
          <label>YanÄ±nda Ä°yi Gidenler</label>
          <div id="updateProductSideDishesContainer"></div>
          
          <hr/>
          <h3>Birimler (Ä°steÄŸe BaÄŸlÄ±)</h3>
          <p style="font-size: 0.9em; color: #555;">
            Mevcut birimleri dÃ¼zenleyebilir, yenilerini ekleyebilir veya silebilirsiniz.
          </p>
          <div id="updateVariantsContainer"></div>
          <button type="button" style="margin-bottom:15px;" onclick="addVariantRow('updateVariantsContainer')">Birim Ekle</button>
          
          <label for="updateFileElem">ÃœrÃ¼n Resmi</label>
          <input type="file" id="updateFileElem" accept="image/*">
          <img id="updateProductImagePreview" src="#" alt="ÃœrÃ¼n Resmi" style="display:none; max-width:200px; margin-top:10px;">
          <div class="progress-bar" id="updateProgressBar" style="display:none;">
            <div class="progress-bar-fill" id="updateProgressBarFill">0%</div>
          </div>
          <button type="submit">GÃ¼ncelle</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Kategori GÃ¼ncelleme ModalÄ± -->
  <div id="updateCategoryModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        Kategoriyi GÃ¼ncelle
        <span class="close" id="closeCategoryModal">&times;</span>
      </div>
      <div class="modal-body">
        <form id="updateCategoryForm">
          <input type="hidden" id="updateCategoryId">
          <label for="updateCategoryName_tr">Kategori Ä°smi (TR)</label>
          <input type="text" id="updateCategoryName_tr" placeholder="Kategori Ä°smi (TR)" required>
          <label for="updateCategoryName_en">Kategori Ä°smi (EN)</label>
          <input type="text" id="updateCategoryName_en" value="" readonly>
          <label for="updateCategoryImage">Kategori Resmi</label>
          <input type="file" id="updateCategoryImage" accept="image/*">
          <img id="updateCategoryImagePreview" src="#" alt="Kategori Resmi" style="display:none; max-width:200px; margin-top:10px;">
          <div class="progress-bar" id="updateCategoryProgressBar" style="display:none;">
            <div class="progress-bar-fill" id="updateCategoryProgressBarFill">0%</div>
          </div>
          <label for="updateCategoryStatus">Durum</label>
          <select id="updateCategoryStatus" required>
            <option value="active">Aktif</option>
            <option value="inactive">AskÄ±da</option>
          </select>
          <button type="submit">GÃ¼ncelle</button>
        </form>
      </div>
    </div>
  </div>

  <!-- JavaScript KodlarÄ± -->
  <script>
    /* Firebase YapÄ±landÄ±rmasÄ± */
    const firebaseConfig = {
    apiKey: "AIzaSyA16M_6xOrUGEn9YCdzIFxBYXr-9ST7IWY",
    authDomain: "qrmenuapplication-9b920.firebaseapp.com",
    databaseURL: "https://qrmenuapplication-9b920-default-rtdb.firebaseio.com",
    projectId: "qrmenuapplication-9b920",
    storageBucket: "qrmenuapplication-9b920.appspot.com",
    messagingSenderId: "1050979828232",
    appId: "1:1050979828232:web:54d81e21056193bee147bd",
    measurementId: "G-C3S611TREX"
};
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const storage = firebase.storage();
    const auth = firebase.auth();
    auth.onAuthStateChanged(user => {
  if (user) {
    document.getElementById('loginDiv').style.display = 'none';
    document.getElementById('adminContent').style.display = 'block';

    loadCompanyInfo();  // Firma bilgilerini form alanlarÄ±na otomatik doldur
  } else {
    document.getElementById('loginDiv').style.display = 'block';
    document.getElementById('adminContent').style.display = 'none';
  }
});

    /* YardÄ±mcÄ± Fonksiyonlar */
    function dataURItoBlob(dataURI) {
      const byteString = atob(dataURI.split(',')[1]);
      const mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
      const ab = new ArrayBuffer(byteString.length);
      const ia = new Uint8Array(ab);
      for (let i = 0; i < byteString.length; i++) {
        ia[i] = byteString.charCodeAt(i);
      }
      return new Blob([ab], { type: mimeString });
    }
    function resizeAndCompressImage(file, maxWidth, maxHeight, quality, callback) {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = function(event) {
        const img = new Image();
        img.src = event.target.result;
        img.onload = function() {
          let canvas = document.createElement('canvas');
          let ctx = canvas.getContext('2d');
          let width = img.width;
          let height = img.height;
          if (width > maxWidth || height > maxHeight) {
            if (width / height > maxWidth / maxHeight) {
              height = height * (maxWidth / width);
              width = maxWidth;
            } else {
              width = width * (maxHeight / height);
              height = maxHeight;
            }
          }
          canvas.width = width;
          canvas.height = height;
          ctx.drawImage(img, 0, 0, width, height);
          const dataURL = canvas.toDataURL('image/jpeg', quality);
          callback(dataURL);
        };
      };
    }

    // Dinamik Birim Ekleme
    function addVariantRow(containerId, variantData = null) {
      const container = document.getElementById(containerId);
      const div = document.createElement('div');
      div.classList.add('variant-row');
      // Backtick (template literal) ile HTML oluÅŸturuldu
      div.innerHTML = `
        <input type="text" class="variant-name" placeholder="Birim AdÄ± (Ã¶rn: 1 Porsiyon)">
        <input type="number" class="variant-price" placeholder="Fiyat (Ã¶rn: 50)">
        <button type="button" onclick="this.parentNode.remove()">Sil</button>
      `;
      container.appendChild(div);

      if (variantData) {
        div.querySelector('.variant-name').value = variantData.name || '';
        div.querySelector('.variant-price').value = variantData.price || '';
      }
    }
    function getVariantsFromContainer(containerId) {
      const container = document.getElementById(containerId);
      const rows = container.querySelectorAll('.variant-row');
      let variants = [];
      rows.forEach(row => {
        const nameInput = row.querySelector('.variant-name');
        const priceInput = row.querySelector('.variant-price');
        const nameVal = (nameInput.value || '').trim();
        const priceVal = parseFloat((priceInput.value || '').trim());
        if (nameVal && !isNaN(priceVal)) {
          variants.push({ name: nameVal, price: priceVal });
        }
      });
      return variants;
    }

    // Yeni: YanÄ±nda Ä°yi Gidenler iÃ§in checkbox'larÄ± oluÅŸtur (Yeni Ã¼rÃ¼n formu)
    function loadAllProductsForSideDishesCheckbox(containerId, excludeId = null, preSelected = []) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      database.ref('Products7').once('value', snapshot => {
        const data = snapshot.val() || {};
        for (let pid in data) {
          if (pid === excludeId) continue;
          const pVal = data[pid];
          const label = document.createElement('label');
          label.style.display = 'block';
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.value = pid;
          if (preSelected.includes(pid)) {
            checkbox.checked = true;
          }
          label.appendChild(checkbox);
          label.appendChild(document.createTextNode(" " + (pVal.name_tr || "ÃœrÃ¼n")));
          container.appendChild(label);
        }
      });
    }

    // Yeni: "ÃœrÃ¼n Ekle" formunda yan Ã¼rÃ¼nler iÃ§in container ekle (HTML'de <div id="productSideDishesContainer"></div> ekleyin)
    // Benzer ÅŸekilde gÃ¼ncelleme formu iÃ§in: <div id="updateProductSideDishesContainer"></div>

    // Admin Auth
    function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          document.getElementById('loginDiv').style.display = 'none';
          document.getElementById('adminContent').style.display = 'block';
          loadCategories();
          loadProducts();
        })
        .catch(error => {
          alert("GiriÅŸ baÅŸarÄ±sÄ±z: " + error.message);
        });
    }
    function logout() {
      window.location.href = "masa.html";
    }

    // Sekme geÃ§iÅŸleri
    function switchTab(tab) {
      const tabs = ["categories", "addCategory", "products", "addProduct", "companyInfo"];
      tabs.forEach(t => {
        document.getElementById("btn" + capitalize(t)).classList.remove("active");
        document.getElementById("tab" + capitalize(t)).classList.remove("active");
      });
      document.getElementById("btn" + capitalize(tab)).classList.add("active");
      document.getElementById("tab" + capitalize(tab)).classList.add("active");
      if (tab === "addProduct") {
        prepareNewProductForm();
      }
    }
    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    // Firma Bilgileri Formunu Kaydetme (Yeni Sekme)
    document.getElementById('companyInfoForm')?.addEventListener('submit', function(e) {
      e.preventDefault();
      const googleMaps = document.getElementById('companyGoogleMaps').value.trim();
const instagram = document.getElementById('companyInstagram').value.trim();
const facebook = document.getElementById('companyFacebook').value.trim();
const youtube = document.getElementById('companyYoutube').value.trim();
const whatsapp = document.getElementById('companyWhatsapp').value.trim();
const wifi = document.getElementById('companyWifi').value.trim();

database.ref('CompanyInfo').set({
  googleMaps: googleMaps,
  instagram: instagram,
  facebook: facebook,
  youtube: youtube,
  whatsapp: whatsapp,
  wifi: wifi
}).then(() => {
  alert("Firma bilgileri baÅŸarÄ±yla kaydedildi!");
}).catch(err => {
  alert("Hata: " + err.message);
});
    });
    function loadCompanyInfo() {
  database.ref('CompanyInfo').once('value').then(snapshot => {
    if (snapshot.exists()) {
      const data = snapshot.val();
      document.getElementById('companyGoogleMaps').value = data.googleMaps || "";
      document.getElementById('companyInstagram').value = data.instagram || "";
      document.getElementById('companyFacebook').value = data.facebook || "";
      document.getElementById('companyYoutube').value = data.youtube || "";
      document.getElementById('companyWhatsapp').value = data.whatsapp || "";
      document.getElementById('companyWifi').value = data.wifi || "";
    }
  }).catch(error => {
    console.error("Firma bilgileri yÃ¼klenirken hata:", error);
  });
}

    // Kategorileri YÃ¼kle
    function loadCategories() {
      const sortableList = document.getElementById('sortableCategories');
      const productCategorySelect = document.getElementById('productCategory');
      const filterCategorySelect = document.getElementById('filterCategory');
      const updateProductCategorySelect = document.getElementById('updateProductCategory');
      sortableList.innerHTML = '';
      productCategorySelect.innerHTML = '<option value="">Kategori SeÃ§in</option>';
      filterCategorySelect.innerHTML = '<option value="">Hepsi</option>';
      if (updateProductCategorySelect) updateProductCategorySelect.innerHTML = '<option value="">Kategori SeÃ§in</option>';
      database.ref('Categories7').orderByChild('order').once('value', snapshot => {
        snapshot.forEach(childSnapshot => {
          const category = childSnapshot.val();
          const categoryId = childSnapshot.key;
          const categoryName = category.name_tr || "Kategori";
          const categoryStatus = category.status || 'active';
          let li = document.createElement('li');
          li.className = 'category-item';
          li.setAttribute('data-id', categoryId);
          let infoDiv = document.createElement('div');
          infoDiv.textContent = categoryName;
          if (categoryStatus === 'inactive') {
            infoDiv.style.color = 'gray';
            infoDiv.textContent += ' (AskÄ±da)';
          }
          let editBtn = document.createElement('button');
          editBtn.textContent = 'DÃ¼zenle';
          editBtn.onclick = () => openUpdateCategoryModal(categoryId);
          let deleteBtn = document.createElement('button');
          deleteBtn.textContent = 'Sil';
          deleteBtn.onclick = () => deleteCategory(categoryId);
          li.append(infoDiv, editBtn, deleteBtn);
          sortableList.appendChild(li);

          if (categoryStatus === 'active') {
            let option = document.createElement('option');
            option.value = categoryId;
            option.textContent = categoryName;
            productCategorySelect.appendChild(option);
            let filterOption = document.createElement('option');
            filterOption.value = categoryId;
            filterOption.textContent = categoryName;
            filterCategorySelect.appendChild(filterOption);
            if (updateProductCategorySelect) {
              let updateOption = document.createElement('option');
              updateOption.value = categoryId;
              updateOption.textContent = categoryName;
              updateProductCategorySelect.appendChild(updateOption);
            }
          }
        });
        new Sortable(sortableList, {
          animation: 150,
          onEnd: updateCategoryOrder
        });
      });
    }
    function updateCategoryOrder(evt) {
      const items = evt.to.children;
      for (let i = 0; i < items.length; i++) {
        const categoryId = items[i].getAttribute('data-id');
        database.ref('Categories7/' + categoryId).update({ order: i });
      }
    }
    function deleteCategory(categoryId) {
      if (confirm("Bu kategoriyi silmek istediÄŸinizden emin misiniz? Bu iÅŸlem geri alÄ±namaz.")) {
        database.ref('Products7').orderByChild('categoryId').equalTo(categoryId).once('value', snapshot => {
          snapshot.forEach(childSnapshot => {
            database.ref('Products7/' + childSnapshot.key).remove();
          });
          database.ref('Categories7/' + categoryId).remove()
            .then(() => {
              alert("Kategori ve ilgili Ã¼rÃ¼nler baÅŸarÄ±yla silindi!");
              loadCategories();
              loadProducts();
            })
            .catch(error => {
              alert("Silme hatasÄ±: " + error.message);
            });
        });
      }
    }
    function openUpdateCategoryModal(categoryId) {
      document.getElementById('updateCategoryModal').style.display = 'block';
      database.ref('Categories7/' + categoryId).once('value', snapshot => {
        const category = snapshot.val();
        document.getElementById('updateCategoryId').value = categoryId;
        document.getElementById('updateCategoryName_tr').value = category.name_tr || '';
        document.getElementById('updateCategoryName_en').value = category.name_tr || ''; // Sadece TÃ¼rkÃ§e kullanÄ±lacak
        document.getElementById('updateCategoryStatus').value = category.status || 'active';
        const preview = document.getElementById('updateCategoryImagePreview');
        preview.src = category.imageUrl || '';
        preview.style.display = 'block';
      });
    }
    document.getElementById('updateCategoryImage').addEventListener('change', function() {
      const file = this.files[0];
      if (file) {
        resizeAndCompressImage(file, 800, 800, 0.7, function(dataUrl) {
          const preview = document.getElementById('updateCategoryImagePreview');
          preview.src = dataUrl;
          preview.style.display = 'block';
        });
      }
    });
    document.getElementById('updateCategoryForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const categoryId = document.getElementById('updateCategoryId').value;
      const name_tr = document.getElementById('updateCategoryName_tr').value;
      const name_en = document.getElementById('updateCategoryName_en').value;
      const status = document.getElementById('updateCategoryStatus').value;
      const imageFile = document.getElementById('updateCategoryImage').files[0];
      document.getElementById('updateCategoryProgressBar').style.display = 'block';
      if (imageFile) {
        resizeAndCompressImage(imageFile, 800, 800, 0.7, function(dataUrl) {
          const blob = dataURItoBlob(dataUrl);
          const storageRef = storage.ref('categoryImages7/' + imageFile.name);
          const uploadTask = storageRef.put(blob);
          uploadTask.on('state_changed',
            snapshot => {
              const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
              document.getElementById('updateCategoryProgressBarFill').style.width = progress + '%';
              document.getElementById('updateCategoryProgressBarFill').textContent = Math.round(progress) + '%';
            },
            error => {
              alert('YÃ¼kleme hatasÄ±: ' + error.message);
            },
            () => {
              uploadTask.snapshot.ref.getDownloadURL().then(url => {
                updateCategory(categoryId, name_tr, name_en, url, status);
              });
            }
          );
        });
      } else {
        database.ref('Categories7/' + categoryId).once('value', snap => {
          const cat = snap.val();
          updateCategory(categoryId, name_tr, name_en, cat.imageUrl || '', status);
        });
      }
    });
    function updateCategory(categoryId, name_tr, name_en, imageUrl, status) {
      database.ref('Categories7/' + categoryId).update({
        name_tr: name_tr,
        name_en: name_tr, // Sadece TÃ¼rkÃ§e kullanÄ±lacak
        imageUrl: imageUrl,
        status: status
      }).then(() => {
        alert('Kategori gÃ¼ncellendi!');
        document.getElementById('updateCategoryModal').style.display = 'none';
        document.getElementById('updateCategoryProgressBar').style.display = 'none';
        loadCategories();
        loadProducts();
      });
    }
    document.getElementById('closeCategoryModal').onclick = function() {
      document.getElementById('updateCategoryModal').style.display = 'none';
    };

    // Kategori Ekleme Formu
    document.getElementById('newCategoryForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const name_tr = document.getElementById('categoryName_tr').value;
      const name_en = document.getElementById('categoryName_en').value;
      const imageFile = document.getElementById('categoryImage').files[0];
      document.getElementById('categoryProgressBar').style.display = 'block';
      resizeAndCompressImage(imageFile, 800, 800, 0.7, function(dataUrl) {
        const blob = dataURItoBlob(dataUrl);
        const storageRef = storage.ref('categoryImages7/' + imageFile.name);
        const uploadTask = storageRef.put(blob);
        uploadTask.on('state_changed',
          snapshot => {
            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            document.getElementById('categoryProgressBarFill').style.width = progress + '%';
            document.getElementById('categoryProgressBarFill').textContent = Math.round(progress) + '%';
          },
          error => {
            alert('YÃ¼kleme hatasÄ±: ' + error.message);
          },
          () => {
            uploadTask.snapshot.ref.getDownloadURL().then(url => {
              database.ref('Categories7').once('value').then(snap => {
                const catCount = snap.numChildren();
                const newKey = database.ref().child('Categories7').push().key;
                database.ref('Categories7/' + newKey).set({
                  name_tr: name_tr,
                  name_en: name_tr,  // Sadece TÃ¼rkÃ§e
                  imageUrl: url,
                  order: catCount,
                  status: 'active'
                }).then(() => {
                  alert('Kategori baÅŸarÄ±yla eklendi!');
                  document.getElementById('newCategoryForm').reset();
                  document.getElementById('categoryImagePreview').style.display = 'none';
                  document.getElementById('categoryProgressBar').style.display = 'none';
                  loadCategories();
                });
              });
            });
          }
        );
      });
    });
    document.getElementById('categoryImage').addEventListener('change', function() {
      const file = this.files[0];
      if (file) {
        resizeAndCompressImage(file, 800, 800, 0.7, function(dataUrl) {
          const preview = document.getElementById('categoryImagePreview');
          preview.src = dataUrl;
          preview.style.display = 'block';
        });
      }
    });

    // ÃœrÃ¼nlerle Ä°lgili: (ÃœrÃ¼n listeleme, ekleme, gÃ¼ncelleme vs.)
    function loadProducts() {
      const productsList = document.getElementById('productsList');
      productsList.innerHTML = '';
      const selectedCategory = document.getElementById('filterCategory').value;
      database.ref('Products7').once('value', snapshot => {
        snapshot.forEach(childSnapshot => {
          const product = childSnapshot.val();
          const productId = childSnapshot.key;
          if (selectedCategory === '' || selectedCategory === product.categoryId) {
            database.ref('Categories7/' + product.categoryId).once('value', categorySnapshot => {
              if (categorySnapshot.exists()) {
                const category = categorySnapshot.val();
                if (category.status === 'active') {
                  let div = document.createElement('div');
                  div.className = 'product-item';
                  let img = document.createElement('img');
                  img.src = product.imageUrl || '';
                  img.alt = product.name_tr || 'ÃœrÃ¼n';
                  let span = document.createElement('span');
                  let catName = category.name_tr || 'Kategori';
                  let prodName = product.name_tr || 'ÃœrÃ¼n Ä°smi';
                  span.textContent = `${prodName} - ${catName}`;
                  let updateBtn = document.createElement('button');
                  updateBtn.textContent = 'GÃ¼ncelle';
                  updateBtn.onclick = () => openUpdateModal(productId);
                  let deleteBtn = document.createElement('button');
                  deleteBtn.textContent = 'ðŸ—‘ï¸';
                  deleteBtn.classList.add('delete-button');
                  deleteBtn.onclick = () => deleteProduct(productId);
                  div.appendChild(img);
                  div.appendChild(span);
                  div.appendChild(updateBtn);
                  div.appendChild(deleteBtn);
                  productsList.appendChild(div);
                }
              }
            });
          }
        });
      });
    }
    document.getElementById('filterCategory').addEventListener('change', loadProducts);

    // Yeni: YanÄ±nda Ä°yi Gidenler iÃ§in checkbox'lar (Yeni ÃœrÃ¼n formu)
    function loadAllProductsForSideDishesCheckbox(containerId, excludeId = null, preSelected = []) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      database.ref('Products7').once('value', snapshot => {
        const data = snapshot.val() || {};
        for (let pid in data) {
          if (pid === excludeId) continue;
          const pVal = data[pid];
          const label = document.createElement('label');
          label.style.display = 'block';
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.value = pid;
          if (preSelected.includes(pid)) {
            checkbox.checked = true;
          }
          label.appendChild(checkbox);
          label.appendChild(document.createTextNode(" " + (pVal.name_tr || "ÃœrÃ¼n")));
          container.appendChild(label);
        }
      });
    }

    // ÃœrÃ¼n Ekleme Formu: Yeni ÃœrÃ¼n iÃ§in (yanÄ±nda iyi gidenler alanÄ± deÄŸiÅŸtirildi)
    function prepareNewProductForm() {
      loadAllProductsForSideDishesCheckbox('productSideDishesContainer');
    }

    // ÃœrÃ¼n Ekleme Formu
    document.getElementById('newProductForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const name_tr = document.getElementById('productName_tr').value.trim();
      const name_en = document.getElementById('productName_en').value.trim();
      const description_tr = document.getElementById('productDesc_tr').value.trim();
      const description_en = document.getElementById('productDesc_en').value.trim();
      const price = parseFloat(document.getElementById('productPrice').value.trim());
      const categoryId = document.getElementById('productCategory').value;
      const status = document.getElementById('productStatus').value;
      const cookingTime = parseInt(document.getElementById('productCookingTime').value) || 0;
      const calorie = parseInt(document.getElementById('productCalorie').value) || 0;
      const allergen = document.getElementById('productAllergen').value.trim();
      // YanÄ±nda Ä°yi Gidenler: Checkbox'larÄ±n deÄŸerlerini al
      let sideSelected = [];
      const sideContainer = document.getElementById('productSideDishesContainer');
      sideContainer.querySelectorAll('input[type="checkbox"]').forEach(cb => {
        if(cb.checked) sideSelected.push(cb.value);
      });
      const variants = getVariantsFromContainer('newVariantsContainer');
      const imageFile = document.getElementById('fileElem').files[0];
      document.getElementById('productProgressBar').style.display = 'block';
      resizeAndCompressImage(imageFile, 800, 800, 0.7, function(dataUrl) {
        const blob = dataURItoBlob(dataUrl);
        const storageRef = storage.ref('productImages7/' + imageFile.name);
        const uploadTask = storageRef.put(blob);
        uploadTask.on('state_changed',
          snapshot => {
            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            document.getElementById('productProgressBarFill').style.width = progress + '%';
            document.getElementById('productProgressBarFill').textContent = Math.round(progress) + '%';
          },
          error => {
            alert('YÃ¼kleme hatasÄ±: ' + error.message);
          },
          () => {
            uploadTask.snapshot.ref.getDownloadURL().then(url => {
              const newKey = database.ref().child('Products7').push().key;
              let productData = {
                name_tr: name_tr,
                name_en: name_tr,  // Sadece TÃ¼rkÃ§e kullanÄ±lacak
                description_tr: description_tr,
                description_en: description_tr,
                price: price,
                categoryId: categoryId,
                imageUrl: url,
                variants: variants,
                cookingTime: cookingTime > 0 ? cookingTime : null,
                calorie: calorie > 0 ? calorie : null,
                allergen: allergen || null,
                sideDishes: sideSelected,
                status: status
              };
              database.ref('Products7/' + newKey).set(productData).then(() => {
                alert('ÃœrÃ¼n baÅŸarÄ±yla eklendi!');
                document.getElementById('newProductForm').reset();
                document.getElementById('productImagePreview').style.display = 'none';
                document.getElementById('productProgressBar').style.display = 'none';
                document.getElementById('newVariantsContainer').innerHTML = '';
                loadProducts();
              });
            });
          }
        );
      });
    });
    document.getElementById('fileElem').addEventListener('change', function() {
      const file = this.files[0];
      if (file) {
        resizeAndCompressImage(file, 800, 800, 0.7, function(dataUrl) {
          const preview = document.getElementById('productImagePreview');
          preview.src = dataUrl;
          preview.style.display = 'block';
        });
      }
    });

    // ÃœrÃ¼n GÃ¼ncelleme
    function openUpdateModal(productId) {
      document.getElementById('updateFileElem').value = "";
      const preview = document.getElementById('updateProductImagePreview');
      preview.src = "";
      preview.style.display = 'none';
      document.getElementById('updateVariantsContainer').innerHTML = '';
      document.getElementById('updateProductModal').style.display = 'block';
      database.ref('Products7/' + productId).once('value', snapshot => {
        const product = snapshot.val();
        document.getElementById('updateProductId').value = productId;
        document.getElementById('updateProductName_tr').value = product.name_tr || '';
        document.getElementById('updateProductName_en').value = product.name_tr || '';
        document.getElementById('updateProductDesc_tr').value = product.description_tr || '';
        document.getElementById('updateProductDesc_en').value = product.description_tr || '';
        document.getElementById('updateProductPrice').value = product.price || 0;
        document.getElementById('updateProductCategory').value = product.categoryId || '';
        document.getElementById('updateProductCookingTime').value = product.cookingTime || '';
        document.getElementById('updateProductCalorie').value = product.calorie || '';
        document.getElementById('updateProductAllergen').value = product.allergen || '';
        document.getElementById('updateProductStatus').value = product.status || 'active';
        if (product.imageUrl) {
          preview.src = product.imageUrl;
          preview.style.display = 'block';
        }
        if (product.variants && Array.isArray(product.variants)) {
          product.variants.forEach(variant => {
            addVariantRow('updateVariantsContainer', variant);
          });
        }
        const preSelectedSide = product.sideDishes || [];
        loadAllProductsForSideDishesCheckbox('updateProductSideDishesContainer', productId, preSelectedSide);
      });
    }
    document.getElementById('updateFileElem').addEventListener('change', function() {
      const file = this.files[0];
      if (file) {
        resizeAndCompressImage(file, 800, 800, 0.7, function(dataUrl) {
          const preview = document.getElementById('updateProductImagePreview');
          preview.src = dataUrl;
          preview.style.display = 'block';
        });
      }
    });
    document.getElementById('updateProductForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const productId = document.getElementById('updateProductId').value;
      const name_tr = document.getElementById('updateProductName_tr').value.trim();
      const name_en = document.getElementById('updateProductName_en').value.trim();
      const description_tr = document.getElementById('updateProductDesc_tr').value.trim();
      const description_en = document.getElementById('updateProductDesc_en').value.trim();
      const price = parseFloat(document.getElementById('updateProductPrice').value.trim());
      const categoryId = document.getElementById('updateProductCategory').value;
      const status = document.getElementById('updateProductStatus').value;
      const cookingTime = parseInt(document.getElementById('updateProductCookingTime').value) || 0;
      const calorie = parseInt(document.getElementById('updateProductCalorie').value) || 0;
      const allergen = document.getElementById('updateProductAllergen').value.trim();
      let sideSelected = [];
      const sideContainer = document.getElementById('updateProductSideDishesContainer');
      sideContainer.querySelectorAll('input[type="checkbox"]').forEach(cb => {
        if (cb.checked) sideSelected.push(cb.value);
      });
      const variants = getVariantsFromContainer('updateVariantsContainer');
      const imageFile = document.getElementById('updateFileElem').files[0];
      document.getElementById('updateProgressBar').style.display = 'block';
      if (imageFile) {
        resizeAndCompressImage(imageFile, 800, 800, 0.7, function(dataUrl) {
          const blob = dataURItoBlob(dataUrl);
          const storageRef = storage.ref('productImages7/' + imageFile.name);
          const uploadTask = storageRef.put(blob);
          uploadTask.on('state_changed',
            snapshot => {
              const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
              document.getElementById('updateProgressBarFill').style.width = progress + '%';
              document.getElementById('updateProgressBarFill').textContent = Math.round(progress) + '%';
            },
            error => {
              alert('YÃ¼kleme hatasÄ±: ' + error.message);
            },
            () => {
              uploadTask.snapshot.ref.getDownloadURL().then(url => {
                saveUpdatedProduct(productId, name_tr, name_en, description_tr, description_en, price, categoryId, url, variants, cookingTime, calorie, allergen, sideSelected, status);
              });
            }
          );
        });
      } else {
        database.ref('Products7/' + productId).once('value', snap => {
          const prod = snap.val();
          const oldUrl = prod.imageUrl || '';
          saveUpdatedProduct(productId, name_tr, name_en, description_tr, description_en, price, categoryId, oldUrl, variants, cookingTime, calorie, allergen, sideSelected, status);
        });
      }
    });
    function saveUpdatedProduct(pid, ntr, nen, dtr, den, prc, cat, imgUrl, vars, cTime, cal, allerg, side, status) {
      let updatedData = {
        name_tr: ntr,
        name_en: ntr, // Sadece TÃ¼rkÃ§e kullanÄ±lacak
        description_tr: dtr,
        description_en: dtr,
        price: prc,
        categoryId: cat,
        imageUrl: imgUrl,
        variants: vars,
        cookingTime: cTime > 0 ? cTime : null,
        calorie: cal > 0 ? cal : null,
        allergen: allerg || null,
        sideDishes: side || [],
        status: status
      };
      database.ref('Products7/' + pid).set(updatedData)
      .then(() => {
        alert('ÃœrÃ¼n baÅŸarÄ±yla gÃ¼ncellendi!');
        document.getElementById('updateProductModal').style.display = 'none';
        document.getElementById('updateProgressBar').style.display = 'none';
        loadProducts();
      });
    }
    function deleteProduct(productId) {
      if (confirm("Bu Ã¼rÃ¼nÃ¼ silmek istediÄŸinizden emin misiniz?")) {
        database.ref('Products7/' + productId).remove()
          .then(() => {
            alert("ÃœrÃ¼n baÅŸarÄ±yla silindi!");
            loadProducts();
          })
          .catch(error => {
            alert("Silme hatasÄ±: " + error.message);
          });
      }
    }
    document.getElementById('closeModal').onclick = function() {
      document.getElementById('updateProductModal').style.display = 'none';
    };

    // Yeni Ã¼rÃ¼n sekmesi aÃ§Ä±lÄ±rken, "YanÄ±nda Ä°yi Gidenler" kÄ±smÄ± checkbox ile doldurulsun
    function prepareNewProductForm() {
      loadAllProductsForSideDishesCheckbox('productSideDishesContainer');
    }
    // Fonksiyon: YanÄ±nda Ä°yi Gidenler iÃ§in checkbox'larÄ± oluÅŸtur (GÃ¼ncelleme formu)
    function loadAllProductsForSideDishesCheckbox(containerId, excludeId = null, preSelected = []) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      database.ref('Products7').once('value', snapshot => {
        const data = snapshot.val() || {};
        for (let pid in data) {
          if (pid === excludeId) continue;
          const pVal = data[pid];
          const label = document.createElement('label');
          label.style.display = 'block';
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.value = pid;
          if (preSelected.includes(pid)) {
            checkbox.checked = true;
          }
          label.appendChild(checkbox);
          label.appendChild(document.createTextNode(" " + (pVal.name_tr || "ÃœrÃ¼n")));
          container.appendChild(label);
        }
      });
    }

    // Firma Bilgileri Sekmesi
    document.getElementById('companyInfoForm')?.addEventListener('submit', function(e) {
  e.preventDefault();
  const googleMaps = document.getElementById('companyGoogleMaps').value.trim();
  const instagram = document.getElementById('companyInstagram').value.trim();
  const facebook = document.getElementById('companyFacebook').value.trim();
  const youtube = document.getElementById('companyYoutube').value.trim();
  const whatsapp = document.getElementById('companyWhatsapp').value.trim(); // Yeni alan
  const wifi = document.getElementById('companyWifi').value.trim();

  database.ref('CompanyInfo').set({
    googleMaps: googleMaps,
    instagram: instagram,
    facebook: facebook,
    youtube: youtube,
    whatsapp: whatsapp, // Yeni alanÄ±n kaydÄ±
    wifi: wifi
  }).then(() => {
    alert("Firma bilgileri baÅŸarÄ±yla kaydedildi!");
  }).catch(err => {
    alert("Hata: " + err.message);
  });
});


    // Otantikasyon Durumu
    auth.onAuthStateChanged(user => {
      if (user) {
        document.getElementById('loginDiv').style.display = 'none';
        document.getElementById('adminContent').style.display = 'block';
        loadCategories();
        loadProducts();
      } else {
        document.getElementById('loginDiv').style.display = 'block';
        document.getElementById('adminContent').style.display = 'none';
      }
    });
  </script>
</body>
</html>
